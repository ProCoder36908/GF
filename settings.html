<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="settings-container">
        <h2>Customize Your Settings</h2>

        <!-- Palladium Settings -->
        <label for="panicLinkInput">Panic Mode Link:</label>
        <input type="text" id="panicLinkInput" placeholder="Enter Panic Mode Link">

        <label for="panicShortcutInput">Panic Mode Shortcut:</label>
        <input type="text" id="panicShortcutInput" placeholder="Enter Shortcut (e.g., Ctrl+Alt+P)">
        
        <!-- Nexus Settings -->
        <label for="titleInput">Change Website Title:</label>
        <input type="text" id="titleInput" placeholder="Enter new title">

        <label for="faviconInput">Change Favicon URL:</label>
        <input type="text" id="faviconInput" placeholder="Enter new favicon URL">

        <button class="nice-button" onclick="applySettings()">Apply Settings</button>
    </div>

    <button class="open-site-button" onclick="openAboutBlank()">Open about:blank</button>

    <script>
        function applySettings() {
            // Palladium Settings
            const panicLink = document.getElementById("panicLinkInput").value;
            const panicShortcut = document.getElementById("panicShortcutInput").value;

            localStorage.setItem("panicLink", panicLink);
            localStorage.setItem("panicShortcut", panicShortcut);

            // Nexus Settings
            const newTitle = document.getElementById("titleInput").value;
            const newFavicon = document.getElementById("faviconInput").value;

            document.title = newTitle || "Palladium HQ";

            const favicon = document.querySelector("link[rel='icon']");
            if (newFavicon) {
                favicon.href = newFavicon;
            }

            localStorage.setItem("customTitle", newTitle);
            localStorage.setItem("customFavicon", newFavicon);

            alert("Settings applied successfully!");
        }

        function openAboutBlank() {
            var win = window.open();
            win.document.body.style.margin = "0";
            win.document.body.style.height = "100vh";
            var iframe = win.document.createElement("iframe");
            iframe.style.border = "none";
            iframe.style.width = "100%";
            iframe.style.height = "100%";
            iframe.style.margin = "0";
            iframe.referrerPolicy = "no-referrer";
            iframe.allow = "fullscreen";
            iframe.src = "index.html";
            win.document.body.appendChild(iframe);
        }

        document.addEventListener("DOMContentLoaded", function() {
            // Palladium Settings
            const savedPanicLink = localStorage.getItem("panicLink");
            const savedPanicShortcut = localStorage.getItem("panicShortcut");

            if (savedPanicLink) {
                document.getElementById("panicLinkInput").value = savedPanicLink;
            }

            if (savedPanicShortcut) {
                document.getElementById("panicShortcutInput").value = savedPanicShortcut;
            }

            // Nexus Settings
            const savedTitle = localStorage.getItem("customTitle");
            const savedFavicon = localStorage.getItem("customFavicon");

            if (savedTitle) {
                document.title = savedTitle;
                document.getElementById("titleInput").value = savedTitle;
            }

            if (savedFavicon) {
                const favicon = document.querySelector("link[rel='icon']");
                favicon.href = savedFavicon;
                document.getElementById("faviconInput").value = savedFavicon;
            }
        });

        document.addEventListener("keydown", function(event) {
            const savedPanicShortcut = localStorage.getItem("panicShortcut");

            if (savedPanicShortcut) {
                const keys = savedPanicShortcut.split("+");
                const modifiers = keys.slice(0, keys.length - 1).map(modifier => modifier.toLowerCase());
                const key = keys[keys.length - 1].toLowerCase();

                if (event.key.toLowerCase() === key && modifiers.every(modifier => event[`${modifier}Key`])) {
                    const savedPanicLink = localStorage.getItem("panicLink");

                    if (savedPanicLink) {
                        window.location.href = savedPanicLink;
                    }
                }
            }
        });

        var tabDisguiseEnabled = localStorage.getItem("tabDisguise") === "true";
        if (tabDisguiseEnabled) {
            setCloak("Google", "https://www.google.com/favicon.ico");
        }

        function setCloak(name, iconURL) {
            console.log(`Setting cloak for ${name} with icon URL: ${iconURL}`);
            document.getElementById("dynamic-favicon").href = iconURL;
            document.title = "Google - Search the web";
        }
    </script>
</body>
</html>
